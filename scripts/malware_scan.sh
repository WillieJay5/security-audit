#!/bin/bash
echo "🦠 Running ClamAV Malware Scan..."
sudo apt install -y clamav clamav-daemon

#stop previous running processes
echo "stopping ClamAV Services"
sudo systemctl stop clamav-freshclam
sudo systemctl stop clamav-daemon

# Fix log file permissions
echo "🔧 Fixing log file permissions..."
sudo rm -f /var/log/clamav/freshclam.log.lock
sudo rm -f /var/log/clamav/freshclam.log
sudo chown -R clamav:clamav /var/log/clamav
sudo chmod -R 755 /var/log/clamav

# Update ClamAV databaseecho 
"🌍 Updating ClamAV database..."
sudo freshclam > /dev/null 2>&1

# Restart ClamAV services
echo "🚀 Restarting ClamAV services..."
sudo systemctl start clamav-freshclam
sudo systemctl start clamav-daemon

#Run ClamAV scan silently
echo "🔍 Running ClamAV system scan..."
sudo clamdscan --quiet --remove / > reports/malware-scan.log 2>&1 &

echo "✅ ClamAV scan started in the background."
